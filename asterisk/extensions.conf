;================================ DIALPLAN CONFIGURATION ================================
; Call routing and features for corporate environment
; Supports 10-50 extensions with common business features

[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
; Company information
COMPANY_NAME=Your Company
COMPANY_PHONE=+1234567890

; Trunk settings
TRUNK=PJSIP/trunk-provider-endpoint

; Emergency services
EMERGENCY=911

; Office hours (24-hour format)
OFFICE_OPEN=09:00
OFFICE_CLOSE=17:00

; Voicemail settings
VM_CONTEXT=default

;================================ INTERNAL CONTEXT ================================
; Context for internal extensions (desk phones, softphones)
[internal]

; Extension to extension dialing (1000-1049)
exten => _10XX,1,NoOp(Internal call from ${CALLERID(num)} to ${EXTEN})
 same => n,Dial(PJSIP/${EXTEN},30,tr)
 same => n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
 same => n(unavail),VoiceMail(${EXTEN}@${VM_CONTEXT},u)
 same => n,Hangup()
 same => n(busy),VoiceMail(${EXTEN}@${VM_CONTEXT},b)
 same => n,Hangup()

; Voicemail access
exten => *97,1,NoOp(Voicemail access for ${CALLERID(num)})
 same => n,VoiceMailMain(${CALLERID(num)}@${VM_CONTEXT})
 same => n,Hangup()

; Check voicemail for another extension (requires password)
exten => *98,1,NoOp(Voicemail main menu)
 same => n,VoiceMailMain(@${VM_CONTEXT})
 same => n,Hangup()

; Echo test
exten => *43,1,NoOp(Echo test)
 same => n,Answer()
 same => n,Playback(demo-echotest)
 same => n,Echo()
 same => n,Hangup()

; Speaking clock
exten => *60,1,NoOp(Speaking clock)
 same => n,Answer()
 same => n,SayUnixTime()
 same => n,Hangup()

; Conference room 1
exten => 8000,1,NoOp(Conference room 1)
 same => n,Answer()
 same => n,ConfBridge(8000)
 same => n,Hangup()

; Conference room 2 (with PIN)
exten => 8001,1,NoOp(Conference room 2 - Secure)
 same => n,Answer()
 same => n,Authenticate(1234)
 same => n,ConfBridge(8001)
 same => n,Hangup()

; Call parking
exten => 700,1,NoOp(Park call)
 same => n,Park()
 same => n,Hangup()

; Retrieve parked calls (701-720)
exten => _70[1-9],1,NoOp(Retrieve parked call)
 same => n,ParkedCall(${EXTEN})
 same => n,Hangup()

; Intercom/Page all phones
exten => *80,1,NoOp(Page all extensions)
 same => n,Answer()
 same => n,Page(PJSIP/1000&PJSIP/1001&PJSIP/1002&PJSIP/1010,i)
 same => n,Hangup()

; Call recording toggle
exten => *1,1,NoOp(Toggle call recording)
 same => n,Set(RECFILE=/var/spool/asterisk/monitor/${UNIQUEID})
 same => n,MixMonitor(${RECFILE}.wav)
 same => n,Playback(beep)
 same => n,Hangup()

; Outbound calls - Local (7 digits)
exten => _NXXXXXX,1,NoOp(Local call to ${EXTEN})
 same => n,Set(CALLERID(num)=${COMPANY_PHONE})
 same => n,Dial(${TRUNK}/${EXTEN},60,tr)
 same => n,Hangup()

; Outbound calls - Long distance (1 + 10 digits)
exten => _1NXXNXXXXXX,1,NoOp(Long distance call to ${EXTEN})
 same => n,Set(CALLERID(num)=${COMPANY_PHONE})
 same => n,Dial(${TRUNK}/${EXTEN},60,tr)
 same => n,Hangup()

; Outbound calls - International (011 + country code + number)
exten => _011.,1,NoOp(International call to ${EXTEN})
 same => n,Set(CALLERID(num)=${COMPANY_PHONE})
 same => n,Dial(${TRUNK}/${EXTEN},60,tr)
 same => n,Hangup()

; Emergency services
exten => 911,1,NoOp(EMERGENCY CALL from ${CALLERID(num)})
 same => n,Set(CALLERID(num)=${COMPANY_PHONE})
 same => n,Dial(${TRUNK}/911,60,tr)
 same => n,Hangup()

; Operator/Reception (extension 0)
exten => 0,1,NoOp(Operator call)
 same => n,Dial(PJSIP/1000,30,tr)
 same => n,VoiceMail(1000@${VM_CONTEXT},u)
 same => n,Hangup()

; Invalid extension
exten => _X.,1,NoOp(Invalid extension: ${EXTEN})
 same => n,Playback(pbx-invalid)
 same => n,Hangup()

;================================ INBOUND FROM TRUNK ================================
; Context for incoming calls from SIP trunk
[from-trunk]

; Main company number - ring reception then go to IVR
exten => ${COMPANY_PHONE},1,NoOp(Incoming call from ${CALLERID(num)})
 same => n,Answer()
 same => n,Dial(PJSIP/1000,20,tr)
 same => n,Goto(ivr-main,s,1)

; DID mapping - map external numbers to internal extensions
; Example: +1234567891 -> Extension 1001
exten => +1234567891,1,NoOp(DID call to extension 1001)
 same => n,Dial(PJSIP/1001,30,tr)
 same => n,VoiceMail(1001@${VM_CONTEXT},u)
 same => n,Hangup()

; Add more DID mappings as needed for ported numbers
; exten => +1234567892,1,Dial(PJSIP/1002,30,tr)

; Default incoming - send to IVR
exten => _X.,1,NoOp(Unmatched incoming call)
 same => n,Goto(ivr-main,s,1)

;================================ IVR MENU ================================
[ivr-main]
exten => s,1,NoOp(Main IVR)
 same => n,Answer()
 same => n,Background(welcome)
 same => n,Background(custom/company-greeting)
 same => n,WaitExten(10)
 same => n,Goto(s,1)

; Press 1 for Sales
exten => 1,1,NoOp(IVR: Sales)
 same => n,Dial(PJSIP/1002,30,tr)
 same => n,VoiceMail(1002@${VM_CONTEXT},u)
 same => n,Hangup()

; Press 2 for Support
exten => 2,1,NoOp(IVR: Support)
 same => n,Dial(PJSIP/1010,30,tr)
 same => n,VoiceMail(1010@${VM_CONTEXT},u)
 same => n,Hangup()

; Press 0 for Operator
exten => 0,1,NoOp(IVR: Operator)
 same => n,Dial(PJSIP/1000,30,tr)
 same => n,VoiceMail(1000@${VM_CONTEXT},u)
 same => n,Hangup()

; Timeout
exten => t,1,Playback(goodbye)
 same => n,Hangup()

; Invalid option
exten => i,1,Playback(pbx-invalid)
 same => n,Goto(s,1)

