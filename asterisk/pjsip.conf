;================================ PJSIP CONFIGURATION ================================
; Modern SIP configuration for Asterisk using PJSIP
; This configuration supports 10-50 extensions for a corporate environment

[global]
type=global
max_forwards=70
user_agent=Asterisk PBX
default_realm=asterisk.local
keep_alive_interval=90

;================================ TRANSPORT ================================
; UDP Transport
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
external_media_address=
external_signaling_address=

; TCP Transport (optional, for devices that prefer TCP)
[transport-tcp]
type=transport
protocol=tcp
bind=0.0.0.0:5060

; TLS Transport (recommended for security)
[transport-tls]
type=transport
protocol=tls
bind=0.0.0.0:5061
cert_file=/etc/asterisk/keys/asterisk.crt
priv_key_file=/etc/asterisk/keys/asterisk.key
cipher=ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256
method=tlsv1_2

;================================ TEMPLATES ================================
; Template for internal endpoints (desk phones, softphones)
[endpoint-internal](!)
type=endpoint
context=internal
disallow=all
allow=ulaw
allow=alaw
allow=g722
allow=opus
direct_media=no
trust_id_inbound=yes
device_state_busy_at=2
dtmf_mode=rfc4733
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
ice_support=yes
allow_subscribe=yes
subscribe_context=internal
mwi_subscribe_replaces_unsolicited=yes

; Template for authentication
[auth-userpass](!)
type=auth
auth_type=userpass

; Template for AOR (Address of Record)
[aor-single](!)
type=aor
max_contacts=3
remove_existing=yes
qualify_frequency=60

;================================ SIP TRUNK (Example) ================================
; Example SIP trunk configuration - adjust for your provider
[trunk-provider]
type=registration
transport=transport-udp
outbound_auth=trunk-provider-auth
server_uri=sip:sip.provider.com
client_uri=sip:yourcompany@sip.provider.com
retry_interval=60

[trunk-provider-auth]
type=auth
auth_type=userpass
username=yourcompany
password=CHANGE_ME_TRUNK_PASSWORD

[trunk-provider-endpoint]
type=endpoint
context=from-trunk
disallow=all
allow=ulaw
allow=alaw
transport=transport-udp
from_user=yourcompany
outbound_auth=trunk-provider-auth
aors=trunk-provider-aor

[trunk-provider-aor]
type=aor
contact=sip:sip.provider.com

[trunk-provider-identify]
type=identify
endpoint=trunk-provider-endpoint
match=sip.provider.com

;================================ INTERNAL EXTENSIONS ================================
; Extension 1000 - Test User 1
[1000](endpoint-internal)
auth=1000
aors=1000
callerid="Test User 1" <1000>

[1000](auth-userpass)
username=1000
password=TestPass1000

[1000](aor-single)

; Extension 1001 - Test User 2
[1001](endpoint-internal)
auth=1001
aors=1001
callerid="Test User 2" <1001>

[1001](auth-userpass)
username=1001
password=TestPass1001

[1001](aor-single)

; Extensions 1002-1009 - Department Heads
[1002](endpoint-internal)
auth=1002
aors=1002
callerid="Sales Director" <1002>

[1002](auth-userpass)
username=1002
password=CHANGE_ME_1002

[1002](aor-single)

; Add more extensions as needed (1003-1009)
; Copy the pattern above for each extension

; Extensions 1010-1049 - General Staff
; Example for extension 1010
[1010](endpoint-internal)
auth=1010
aors=1010
callerid="Employee 1010" <1010>

[1010](auth-userpass)
username=1010
password=CHANGE_ME_1010

[1010](aor-single)

; Continue pattern for 1011-1049...
; For production, consider using a database backend (realtime)

